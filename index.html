<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Balanced Line Splitter</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f0f0f0;
    }
    textarea {
      width: 100%;
      height: 200px;
      font-family: monospace;
      font-size: 14px;
      margin-bottom: 10px;
      white-space: pre;
    }
    button {
      padding: 8px 14px;
      font-size: 14px;
    }
    label {
      margin-top: 10px;
      display: block;
    }
  </style>
</head>
<body>

  <h2>Smart Balanced Line Splitter</h2>

  <label for="input">Input Text:</label>
  <textarea id="input" placeholder="Paste your text here..."></textarea>

  <label for="width">Max line width:</label>
  <input type="number" id="width" value="72" min="10" max="200" />

  <br><br>
  <button onclick="processLines()">Process</button>

  <label for="output">Output:</label>
  <textarea id="output" readonly></textarea>

  <script>
    function processLines() {
      const input = document.getElementById("input").value;
      const width = parseInt(document.getElementById("width").value, 10);
      const lines = input.split('\n');
      const outputLines = lines.flatMap(line => splitLineSmart(line, width));
      document.getElementById("output").value = outputLines.join('\n');
    }

    function splitLineSmart(line, maxWidth) {
      if (line.length <= maxWidth) return [line];

      const result = [];

      let segment = line;
      while (segment.length > maxWidth) {
        const breakIndex = findBestBreak(segment, maxWidth);
        if (breakIndex <= 0) break; // no good break, force it

        const left = segment.slice(0, breakIndex + 1).trim();
        const right = segment.slice(breakIndex + 1).trim();

        result.push(left);
        segment = right;
      }

      if (segment.length > 0) result.push(segment);
      return result;
    }

    function findBestBreak(line, maxWidth) {
      const candidates = [];

      for (let i = 0; i < line.length; i++) {
        const char = line[i];
        if (char === ',' || char === ':') {
          candidates.push(i);
        }
      }

      if (candidates.length > 0) {
        let bestIndex = -1;
        let bestBalance = Infinity;

        for (const idx of candidates) {
          const left = line.slice(0, idx + 1).trim();
          const right = line.slice(idx + 1).trim();

          const balance = Math.abs(left.length - right.length);
          if (left.length <= maxWidth && balance < bestBalance) {
            bestIndex = idx;
            bestBalance = balance;
          }
        }

        if (bestIndex !== -1) return bestIndex;
      }

      // fallback to last space before maxWidth
      return line.lastIndexOf(' ', maxWidth);
    }
  </script>

</body>
</html>
